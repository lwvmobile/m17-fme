/*-------------------------------------------------------------------------------
 * m17.h
 * M17 Project - Common Static Arrays for M17 functions
 *
 *
 * LWVMOBILE
 * 2024-05 M17 Project - Florida Man Edition
 *-----------------------------------------------------------------------------*/

//M17 Project Frame Sync Patterns
#define LSF_SYNC_BURST 0x55F7
#define BRT_SYNC_BURST 0xDF55
#define STR_SYNC_BURST 0xFF5D
#define PKT_SYNC_BURST 0x75FF

//Base40 Call Sign Data Character Set
static char b40[] = " ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-/.";

//scramble / randomization bit array
static uint8_t m17_scramble[368] = { 
1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1,
1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0,
1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1,
1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0,
1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0,
1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0,
1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0,
1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1,
0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0,
0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1,
1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,
1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0,
0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1,
0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0,
0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0,
1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0,
0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1,
1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1,
1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1,
0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0,
0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1,
0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1 
};

//p1 puncture
static uint8_t p1[61] = {
1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1,
1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1,
1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1,
1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1
};

//libm17 p1 puncture
static uint8_t puncture_pattern_1[61] = {
    1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
      1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
      1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
      1,0,1,1,1,0,1,1,1,0,1,1
};

//p3 puncture
static uint8_t p3[8] = {1, 1, 1, 1, 1, 1, 1, 0};

//dibits-symbols map
static int8_t symbol_map[4] = {+1, +3, -1, -3};
static int8_t inv_symbol_map[4] = {-1, -3, +1, +3};

//output sample RRC filter for 48kHz sample rate
//alpha=0.5, span=8, sps=10, gain=sqrt(sps)
static float m17_rrc[81] =
{
	-0.003195702904062073f, -0.002930279157647190f, -0.001940667871554463f,
	-0.000356087678023658f,  0.001547011339077758f,  0.003389554791179751f,
	 0.004761898604225673f,  0.005310860846138910f,  0.004824746306020221f,
	 0.003297923526848786f,  0.000958710871218619f, -0.001749908029791816f,
	-0.004238694106631223f, -0.005881783042101693f, -0.006150256456781309f,
	-0.004745376707651645f, -0.001704189656473565f,  0.002547854551539951f,
	 0.007215575568844704f,  0.011231038205363532f,  0.013421952197060707f,
	 0.012730475385624438f,  0.008449554307303753f,  0.000436744366018287f,
	-0.010735380379191660f, -0.023726883538258272f, -0.036498030780605324f,
	-0.046500883189991064f, -0.050979050575999614f, -0.047340680079891187f,
	-0.033554880492651755f, -0.008513823955725943f,  0.027696543159614194f,
	 0.073664520037517042f,  0.126689053778116234f,  0.182990955139333916f,
	 0.238080025892859704f,  0.287235637987091563f,  0.326040247765297220f,
	 0.350895727088112619f,  0.359452932027607974f,  0.350895727088112619f,
	 0.326040247765297220f,  0.287235637987091563f,  0.238080025892859704f,
	 0.182990955139333916f,  0.126689053778116234f,  0.073664520037517042f,
	 0.027696543159614194f, -0.008513823955725943f, -0.033554880492651755f,
	-0.047340680079891187f, -0.050979050575999614f, -0.046500883189991064f,
	-0.036498030780605324f, -0.023726883538258272f, -0.010735380379191660f,
	 0.000436744366018287f,  0.008449554307303753f,  0.012730475385624438f,
	 0.013421952197060707f,  0.011231038205363532f,  0.007215575568844704f,
	 0.002547854551539951f, -0.001704189656473565f, -0.004745376707651645f,
	-0.006150256456781309f, -0.005881783042101693f, -0.004238694106631223f,
	-0.001749908029791816f,  0.000958710871218619f,  0.003297923526848786f,
	 0.004824746306020221f,  0.005310860846138910f,  0.004761898604225673f,
	 0.003389554791179751f,  0.001547011339077758f, -0.000356087678023658f,
	-0.001940667871554463f, -0.002930279157647190f, -0.003195702904062073f
};

static float m17_input_rrc[79] =
{
	-0.00926578400780053, -0.00613655162572969, -0.00112597856207517, +0.00489177725204249,
	+0.01071805138282269, +0.01505751553351295, +0.01679337935001369, +0.01525624514215629,
	+0.01042830577908502, +0.00303152272555990, -0.00553335329681881, -0.01340309982572337,
	-0.01859868234964252, -0.01944761739590459, -0.01500527193595174, -0.00538878803543439,
	+0.00805652591025353, +0.02281624415830727, +0.03551346769220807, +0.04244131815783876,
	+0.04025481153629372, +0.02671818654865632, +0.00138102165167049, -0.03394615682795165,
	-0.07502635967975885, -0.11540977897637611, -0.14703962203941534, -0.16119995609538576,
	-0.14969512896336504, -0.10610329539459686, -0.02692141246963491, +0.08757875030779196,
	+0.23293327870303457, +0.40060122101239920, +0.57863246963255030, +0.75282864799340680,
	+0.90826274144752200, +1.03096611316331990, +1.10956118565480130, +1.13661977236758150,
	+1.10956118565480130, +1.03096611316331990, +0.90826274144752200, +0.75282864799340680,
	+0.57863246963255030, +0.40060122101239920, +0.23293327870303457, +0.08757875030779196,
	-0.02692141246963491, -0.10610329539459686, -0.14969512896336504, -0.16119995609538576,
	-0.14703962203941534, -0.11540977897637611, -0.07502635967975885, -0.03394615682795165,
	+0.00138102165167049, +0.02671818654865632, +0.04025481153629372,  0.04244131815783876,
	+0.03551346769220807, +0.02281624415830727, +0.00805652591025353, -0.00538878803543439,
	-0.01500527193595174, -0.01944761739590459, -0.01859868234964252, -0.01340309982572337,
	-0.00553335329681881, +0.00303152272555990, +0.01042830577908502, +0.01525624514215629,
	+0.01679337935001369, +0.01505751553351295, +0.01071805138282269, +0.00489177725204249,
	-0.00112597856207517, -0.00613655162572969, -0.00926578400780053
};

// syncword patterns (RX) as symbols
static int8_t lsf_sync_symbols[8]={+3, +3, +3, +3, -3, -3, +3, -3};
static int8_t str_sync_symbols[8]={-3, -3, -3, -3, +3, +3, -3, +3};
static int8_t pkt_sync_symbols[8]={+3, -3, +3, +3, -3, -3, -3, -3};
static int8_t brt_sync_symbols[8]={-3, +3, -3, -3, +3, +3, +3, +3};

// symbol levels (RX) as float values
static float symbol_levels[4]={-3.0, -1.0, +1.0, +3.0}; //3,2.0,1

//hopefully there won't be any random linking issues since this function is in main.h
static int stfu ()
{
	//quell defined but not used warnings from m17.h
  UNUSED(b40); UNUSED(m17_scramble); UNUSED(p1); UNUSED(p3); UNUSED(symbol_map); UNUSED(inv_symbol_map); UNUSED(m17_rrc); UNUSED(m17_input_rrc);
  UNUSED(lsf_sync_symbols); UNUSED(str_sync_symbols); UNUSED(pkt_sync_symbols); UNUSED(brt_sync_symbols); UNUSED(symbol_levels);
	UNUSED(puncture_pattern_1);
	return 0;
}